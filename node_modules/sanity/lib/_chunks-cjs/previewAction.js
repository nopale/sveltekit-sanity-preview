"use strict";
var path = require("node:path"), previewServer = require("./previewServer.js");
require("./runtime.js");
var servers = require("./servers.js");
function _interopDefaultCompat(e) {
  return e && typeof e == "object" && "default" in e ? e : { default: e };
}
var path__default = /* @__PURE__ */ _interopDefaultCompat(path), __defProp = Object.defineProperty, __defProps = Object.defineProperties, __getOwnPropDescs = Object.getOwnPropertyDescriptors, __getOwnPropSymbols = Object.getOwnPropertySymbols, __hasOwnProp = Object.prototype.hasOwnProperty, __propIsEnum = Object.prototype.propertyIsEnumerable, __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: !0, configurable: !0, writable: !0, value }) : obj[key] = value, __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    __hasOwnProp.call(b, prop) && __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b))
      __propIsEnum.call(b, prop) && __defNormalProp(a, prop, b[prop]);
  return a;
}, __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));
async function startSanityPreviewServer(args, context) {
  const flags = args.extOptions, {
    workDir,
    cliConfig
  } = context, defaultRootDir = path__default.default.resolve(path__default.default.join(workDir, "dist")), rootDir = path__default.default.resolve(args.argsWithoutOptions[0] || defaultRootDir), config = getPreviewServerConfig({
    flags,
    workDir,
    cliConfig,
    rootDir
  });
  try {
    await previewServer.startPreviewServer(config);
  } catch (err) {
    servers.gracefulServerDeath("preview", config.httpHost, config.httpPort, err);
  }
}
function getPreviewServerConfig({
  flags,
  workDir,
  cliConfig,
  rootDir
}) {
  const baseConfig = servers.getSharedServerConfig({
    flags,
    workDir,
    cliConfig
  });
  return __spreadProps(__spreadValues({}, baseConfig), {
    root: rootDir
  });
}
exports.default = startSanityPreviewServer;
//# sourceMappingURL=previewAction.js.map
