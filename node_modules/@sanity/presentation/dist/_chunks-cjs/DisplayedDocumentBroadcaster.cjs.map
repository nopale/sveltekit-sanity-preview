{"version":3,"file":"DisplayedDocumentBroadcaster.cjs","sources":["../../src/loader/DisplayedDocumentBroadcaster.tsx"],"sourcesContent":["/**\n * Report back up the document state being displayed in the document pane,\n * allowing Presentation Tool to patch the live queries with the same state.\n * This makes the Perspective switcher less confusing, as it applies to everything else on the page.\n * It's also why it's possible to select an older revision and see it in the preview,\n * effectively letting you preview a revert action you might be considering to perform.\n */\n\nimport isEqual from 'fast-deep-equal'\nimport {createContext, useCallback, useContext, useEffect, type PropsWithChildren} from 'react'\nimport {type SanityDocument} from 'sanity'\n\n/** @internal */\nexport type SetDisplayedDocument = (displayed: Partial<SanityDocument> | null | undefined) => void\n\nconst Context = createContext<SetDisplayedDocument | null>(null)\n\nexport interface DisplayedDocumentBroadcasterProps extends PropsWithChildren {\n  setDisplayedDocument: React.Dispatch<\n    React.SetStateAction<Partial<SanityDocument> | null | undefined>\n  >\n  documentId: string | null | undefined\n}\n\nexport function DisplayedDocumentBroadcasterProvider(\n  props: DisplayedDocumentBroadcasterProps,\n): JSX.Element {\n  const {children, setDisplayedDocument, documentId} = props\n\n  const context = useCallback<SetDisplayedDocument>(\n    (next) => setDisplayedDocument((prev) => (isEqual(prev, next) ? prev : next)),\n    [setDisplayedDocument],\n  )\n\n  useEffect(() => {\n    // If no document is currently being displayed then reset the state\n    if (documentId) {\n      return\n    }\n    const timeout = setTimeout(() => setDisplayedDocument(null))\n    return () => clearTimeout(timeout)\n  }, [documentId, setDisplayedDocument])\n\n  return <Context.Provider value={context}>{children}</Context.Provider>\n}\n\nexport function useDisplayedDocumentBroadcaster(): SetDisplayedDocument | null {\n  return useContext(Context)\n}\n"],"names":["Context","createContext","DisplayedDocumentBroadcasterProvider","props","$","_c","children","setDisplayedDocument","documentId","t0","next","prev","isEqual","context","t1","t2","timeout","setTimeout","clearTimeout","useEffect","t3","jsx","useDisplayedDocumentBroadcaster","useContext"],"mappings":";;;;;;AAeA,MAAMA,UAAUC,oBAA2C,IAAI;AASxD,SAAAC,qCAAAC,OAAA;AAAAC,QAAAA,IAAAC,uBAAA,CAAA,GAGL;AAAA,IAAAC;AAAAA,IAAAC;AAAAA,IAAAC;AAAAA,EAAAA,IAAqDL;AAAKM,MAAAA;AAAAL,WAAAG,wBAGxDE,KAAAC,UAAUH,qBAAoBI,CAAAA,SAAYC,yBAAQD,MAAMD,IAAI,IAAIC,OAAOD,IAAK,GAACN,OAAAG,sBAAAH,OAAAK,MAAAA,KAAAL,EAAA,CAAA;AAD/E,QAAAS,UAAgBJ;AAGf,MAAAK,IAAAC;AAAAX,IAAAI,CAAAA,MAAAA,cAAAJ,SAAAG,wBAESO,KAAAA,MAAA;AAEJN,QAAAA;AAAU;AAGd,UAAAQ,UAAgBC,iBAAiBV,qBAAoB,IAAK,CAAC;AAC9CW,WAAAA,MAAAA,aAAaF,OAAO;AAAA,EAChCD,GAAAA,KAAA,CAACP,YAAYD,oBAAoB,GAACH,OAAAI,YAAAJ,OAAAG,sBAAAH,OAAAU,IAAAV,OAAAW,OAAAD,KAAAV,EAAA,CAAA,GAAAW,KAAAX,EAAA,CAAA,IAPrCe,MAAAA,UAAUL,IAOPC,EAAkC;AAACK,MAAAA;AAAA,SAAAhB,EAAAE,CAAAA,MAAAA,YAAAF,SAAAS,WAE/BO,KAAAC,2BAAAA,IAAA,QAAA,UAAA,EAAyBR,OAAAA,SAAUP,SAAAA,CAAS,GAAmBF,OAAAE,UAAAF,OAAAS,SAAAT,OAAAgB,MAAAA,KAAAhB,EAAA,CAAA,GAA/DgB;AAA+D;AAGjE,SAAAE,kCAAA;AAAA,SACEC,MAAAA,WAAAvB,OAAkB;AAAC;;;"}